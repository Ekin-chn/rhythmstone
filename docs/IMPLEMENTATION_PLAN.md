# 阶段性任务拆解（Web + 硬件联动）

> 目标：基于当前代码与最新硬件规范，落地“倾斜选择 + 双阈值握力”的节律石闭环体验。以下 6 个子任务可并行推进。

1. **WebSocket 通道接入（Web 端）**  
   - 新增可配置设备 WS 地址，建立自动重连与在线状态徽标。  
   - 上行处理 `wake/next/prev/confirm`，下行发送 `color/display/vibrate`，打通轮播与硬件反馈。

2. **语音播报与提示策略（Web 端）**  
   - 使用浏览器 TTS 在 `wake` 或轻握事件播报当前卡片标题 + 类型；切换/确认时播报简短反馈。  
   - 提供静音开关或提示失败回退。

3. **任务状态映射与灯效协议（Web 端）**  
   - 维护 `type → color/icon` 映射，在卡片切换、详情打开、确认完成时下发对应 `display`/`color` 指令。  
   - 完成后发送长震与彩虹提示指令，为硬件动画占位。

4. **固件状态机与传感器读取（ESP32C3）**  
   - 在 `RhythmStoneCore` 中实现 IDLE/WAKE/BROWSE/CONFIRM/COMPLETE 状态，FSR 双阈值 + 迟滞，MPU6050 倾斜稳定窗口（>300ms）。  
   - 按协议上报 `wake/next/prev/confirm`，并执行下行的颜色、图标与震动模式。

5. **灯效与震动模式实现（ESP32C3）**  
   - 定义呼吸、常亮、彩虹等 WS2812B 动画；短震/长震 PWM 控制。  
   - 结合状态机切换效果，确保空闲熄灯、浏览常亮、激活呼吸、完成彩虹。

6. **测试与调试工具**  
   - Web 端增加“模拟事件”按钮或控制台指令，便于无硬件时验证轮播与播报。  
   - 固件侧输出串口日志，提供简单的自检（FSR/IMU 原始值）与 WebSocket 心跳。

